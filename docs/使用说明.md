# SnackStock 产品使用说明

## 1. 产品简介

SnackStock 是一个面向零食门店的本地库存管理工具，支持：

- 商品档案管理
- 入库（支持批次与保质期）
- 出库结算（购物车模式）
- 缺货/临期预警
- 日报统计与 CSV 导出
- 数据库文件切换

---

## 2. 开发与部署约定

- 开发机：macOS（开发与提交代码）
- 生产机：Windows（拉取代码并打包运行）
- 当前阶段不启用自动更新机制，采用手动发布

---

## 3. 开发环境启动（macOS）

### 3.1 环境要求

- Python 3.13+
- uv（推荐）

### 3.2 安装依赖

```bash
uv sync
```

或：

```bash
pip install -r requirements.txt
```

### 3.3 启动系统

```bash
uv run python main.py
```

首次启动会自动创建数据库文件：

- `database/inventory.db`

---

## 4. 生产环境运行（Windows）

1. 在 Windows 机器拉取项目代码。
2. 在 Windows 机器完成打包（具体打包脚本/命令按发布文档执行）。
3. 门店通过双击程序图标启动。

说明：

- 当前版本不包含在线更新，升级通过“重新拉取代码并重新打包发布”完成。

---

## 5. 界面结构与切换

系统顶部提供 3 个功能页签，可快速切换：

1. 入库
2. 出库
3. 库存与报表

建议按“先建档，再入库，再出库”的顺序使用。

---

## 6. 入库功能（入库页）

入库页包含两块区域：`商品档案` + `入库扫码`。

### 6.1 新增/更新商品档案

在“商品档案”填写：

- 条码（必填）
- 名称（必填）
- 分类
- 进价
- 售价
- 安全库存

点击 `新增/更新商品` 保存。

### 6.2 扫码入库

在“入库扫码”填写：

- 条码
- 数量
- 批次（建议填写）
- 过期日期（建议填写）

点击 `确认入库` 后：

- 增加入库日志
- 若填写了批次和过期日期，会写入保质期批次库存

---

## 7. 出库功能（出库页）

### 7.1 两种加入购物车方式

#### A. 手动输入条码

1. 在“手动条码”输入条码前缀（输入第一个字符后会弹候选下拉）
2. 选择数量
3. 点击 `手动加入购物车`

匹配规则为“前缀匹配”（按条码开头字符匹配）。

#### B. 扫码枪输入

1. 在“扫码枪模式”输入框扫码
2. 扫描后按回车，系统直接加入购物车
3. 每次扫描默认数量为 1

### 7.2 购物车与结算

- 同一条码商品会自动合并数量
- 可在购物车表格中直接修改数量
- 可点击“移除”删除商品
- 结算区支持录入实收金额（留空默认=应收）
- 支持“应收大于实收”的抹零场景（如应收 61，实收 60）

点击 `结算` 后：

- 扣减库存
- 生成销售日志
- 更新营业额与毛利润显示（营业额按“实收金额”统计）

系统会在结算时检查库存，不足会提示并阻止结算。

---

## 8. 库存与报表（库存与报表页）

### 8.1 数据库文件切换

页面顶部可点击 `选择数据库文件`：

- 可选择已有 `.db` 文件
- 切换后系统会记住所选路径

### 8.2 库存与预警

页面展示：

- 当前库存表（条码、名称、分类、库存、安全库存）
- 搜索框（按条码/名称/分类搜索）
- 表头排序（点击列头排序）
- 预警信息（缺货预警、临期预警）

系统启动时若存在预警，会弹窗汇总提示。

### 8.3 日报统计

页面显示所选日期：

- 营业额
- 进货额
- 毛利润

### 8.4 当日出库记录查询

在库存与报表页：

1. 选择报表日期
2. 点击 `查询当日出库记录`（切换日期也会自动刷新）

系统会展示该日期的出库明细，包括：

- 时间
- 条码
- 商品
- 数量
- 单价
- 小计

### 8.5 导出日报 CSV

操作步骤：

1. 选择报表日期
2. 点击 `导出日报 CSV`
3. 选择保存目录

导出文件名格式：

- `daily_report_YYYY-MM-DD.csv`

---

## 9. 业务规则说明

- 出库扣减批次时，按“到期日优先”（FIFO-by-expiry）扣减已登记批次库存。
- 若历史库存未登记批次，仍可正常出库，但该部分不会体现在批次扣减明细中。
- 所有数据存储在本地 SQLite 文件中，无网络依赖。
- 库存变动日志会按月份自动归档到数据库同目录下 `archives/` 子目录（如 `stock_logs_2026_02.db`），用于控制主数据库体积增长。

---

## 10. 常见问题

### 10.1 扫码无反应

- 确认扫码枪为 HID 键盘模式
- 确认光标位于扫码输入框
- 确认扫码后带回车

### 10.2 提示“商品不存在”

请先在“入库 > 商品档案”创建该条码商品。

### 10.3 导出失败

- 检查目标目录是否有写权限
- 关闭同名 CSV 文件后重试

---

## 11. 数据备份建议

每日或每周至少备份：

- 当前数据库文件（UI 显示的当前路径）
- 同目录下 `archives/` 归档目录

恢复时需同时恢复主数据库与归档目录，以保留完整历史流水。
