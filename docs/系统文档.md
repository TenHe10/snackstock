# 零食小店库存管理系统 (SnackStock v1.0) 开发文档

## 1. 项目概述

本系统旨在利用现有的 **PC + 扫码枪** 硬件组合，替代传统的手写账本或复杂的 Excel 表格，实现零食商品的数字化管理，提高入库效率，并实时掌握库存损耗与利润。

---

## 2. 技术架构选型

为了保证系统的轻量化和“即装即用”，我们选择以下技术路线：

* **运行环境：** Windows (桌面端软件)
* **编程语言：** Python 3.13
* **图形界面：** PyQt6（提供专业的桌面交互体验）
* **数据库：** SQLite 3（单文件数据库，无需安装配置，备份只需拷贝文件）
* **扫码支持：** HID 模式（扫码枪模拟键盘输入）

---

## 3. 数据库逻辑设计

我们需要三张核心表来支撑业务。

### 3.1 商品档案表 (`products`)

用于存储零食的基本信息。
| 字段名 | 类型 | 说明 |
| :--- | :--- | :--- |
| `barcode` | TEXT (PK) | **条形码（主键）** |
| `name` | TEXT | 商品名称 |
| `category` | TEXT | 分类（如：膨化、饮品、辣条） |
| `purchase_price` | REAL | 进货单价 |
| `retail_price` | REAL | 零售单价 |
| `min_stock` | INTEGER | 安全库存阈值（低于此数报警） |

### 3.2 库存变动记录表 (`stock_logs`)

记录每一笔“进”和“出”。
| 字段名 | 类型 | 说明 |
| :--- | :--- | :--- |
| `id` | INTEGER (PK) | 自增 ID |
| `barcode` | TEXT | 关联商品条码 |
| `change_qty` | INTEGER | 变动数量（入库为正，出库为负） |
| `type` | TEXT | 变动类型（采购、销售、过期报损、手动调账） |
| `timestamp` | DATETIME | 操作时间 |

### 3.3 批次与保质期表 (`expiry_management`)

**零食行业核心：** 管理哪一批货什么时候过期。
| 字段名 | 类型 | 说明 |
| :--- | :--- | :--- |
| `barcode` | TEXT | 关联商品条码 |
| `batch_no` | TEXT | 生产批次/日期 |
| `expiry_date` | DATE | **过期日期** |
| `current_qty` | INTEGER | 该批次的剩余库存 |

---

## 4. 功能模块详细说明

### 4.1 扫码入库模块 (Stock-In)

* **自动识别：** 扫码枪扫描后，系统自动查询数据库。
* **智能切换：** * 如果是**已有商品**：自动填入名称，用户仅需输入数量和过期日期。
* 如果是**新商品**：弹出“新商品注册”弹窗，录入单价等基础信息。


* **逻辑：** 增加 `products` 表的总库存（或通过 logs 计算），并记录入库日志。

### 4.2 扫码出库/收银模块 (Stock-Out)

* **连续扫码模式：** 模仿超市收银，每扫一次，待结账列表增加一项。如果重复扫同个商品，数量自动+1。
* **结算功能：** 点击“结算”后，一次性扣减库存，生成销售流水，计算该笔订单的总利润。

### 4.3 库存预警与报表

* **临期提醒：** 系统启动时自动扫描 `expiry_management` 表，弹窗提醒未来 15 天内过期的零食。
* **缺货提醒：** 当当前库存 < `min_stock` 时，界面显著标红。
* **日报表：** 统计本日营业额、进货额、毛利润。

---

## 5. 核心交互流程（扫码枪处理逻辑）

由于扫码枪本质是键盘，我们需要在代码中捕获“回车”事件：

```python
# 伪代码思路
def on_barcode_scanned(barcode_input):
    # 1. 在数据库中查找条码
    product = db.query("SELECT * FROM products WHERE barcode=?", barcode_input)
    
    if product:
        if current_mode == "出库":
            update_cart(product) # 加入购物车
        else:
            show_inbound_dialog(product) # 弹出入库确认
    else:
        show_new_product_form(barcode_input) # 引导注册新商品

```

---

## 6. 项目分期建议

* **第一阶段 (MVP)：** 实现基础的商品录入、扫码入库、扫码出库。
* **第二阶段：** 加入保质期管理和利润报表。
* **第三阶段：** 增加小票打印支持、数据云端备份。

